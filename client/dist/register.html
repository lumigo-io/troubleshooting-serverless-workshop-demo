<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title></title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width">

        <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->

        <link rel="stylesheet" href="css/font.css">
        <link rel="stylesheet" href="css/normalize.css">
        <link rel="stylesheet" href="css/index.css">
        <link rel="stylesheet" href="/css/message.css">
    </head>
    <body>
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
        <![endif]-->

        <header>
          <img src="images/logo.png">
        </header>

        <section class="form-wrap">
            <h1>Register</h1>
            <form id="registrationForm" action="" method="POST" enctype="application/x-www-form-urlencoded">
              <input type="text" id="usernameInputRegister" name="username" placeholder="Username" pattern=".*" required>
              <input type="password" id="passwordInputRegister" name="password" placeholder="Password" pattern=".*" required>
              <input type="submit" value="Let's Ryde">
            </form>
        </section>

        <script src="js/vendor/jquery-3.1.0.js"></script>
        <script src="js/vendor/bootstrap.min.js"></script>
        <script>     

            // Attach a submit handler to the form 
        
            console.log("Inside script");
            $(document).ready(function () {
                $("#registrationForm").submit(function(event) {
                    console.log("Before formdata");
                    var formData = $(this).serialize();
                    console.log(formData);
                    event.stopPropagation();
                    event.preventDefault();
                    $.ajax({
                        url: "/register",
                        data: formData,
                        processData: false,
                        method: "POST",
                        success: function(data, status, xhr) {
                            if (data.error) {
                                alert(data.error);
                                console.log(data);
                            }
                            else {
                                location.href = window.location.origin + "/sign-in";
                            }
                        },
                        error: function(xhr, status, error) {
                            alert(xhr.responseJSON.error);
                            console.log(xhr);
                        }
                    });
                });
            });
        </script>
    </body>
</html>